================================================================================
  ğŸ“± PASO A PASO: IMPLEMENTACIÃ“N APK MÃ“VIL DR GROUP (CONSULTA ONLY)
================================================================================

ğŸ¯ OBJETIVO
-----------
Crear aplicaciÃ³n mÃ³vil de CONSULTA ÃšNICAMENTE (NO CRUD) que replique 
exactamente la funcionalidad del dashboard web, sincronizada 100% con Firestore.

â±ï¸ TIEMPO ESTIMADO TOTAL: 25-35 DÃAS


================================================================================
ğŸ“Š ANÃLISIS COMPLETO DEL DASHBOARD WEB
================================================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
MÃ“DULO 1: CALENDARIO âœ…
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Archivo: src/components/dashboard/DashboardCalendar.jsx

Collection: calendar_events
{
  title: String,
  description: String,
  date: Timestamp,
  priority: 'low' | 'medium' | 'high' | 'urgent',
  createdAt: Timestamp,
  createdBy: String (uid),
  createdByEmail: String,
  createdByName: String
}

Query: Real-time listener
  onSnapshot(query(collection(db, 'calendar_events')))

LÃ³gica Especial:
  â€¢ Festivos colombianos calculados automÃ¡ticamente
  â€¢ 10mo dÃ­a hÃ¡bil â†’ COLJUEGOS
  â€¢ 3er dÃ­a hÃ¡bil â†’ PARAFISCALES
  â€¢ Auto-limpieza eventos >1 aÃ±o

APK: CalendarioScreen (solo vista, NO crear/editar)


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
MÃ“DULO 2: COMPROMISOS âœ…
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Archivos: 
  - src/pages/CommitmentsPage.jsx
  - src/components/commitments/CommitmentsList.jsx

Collection: commitments
{
  companyId: String,
  companyName: String,
  beneficiary: String,
  concept: String,
  amount: Number,
  dueDate: Timestamp,
  status: 'pending' | 'overdue' | 'paid' | 'partially-paid',
  observations: String,
  totalPaid: Number,
  pendingAmount: Number,
  isRecurring: Boolean,
  recurringConfig: Object,
  createdAt: Timestamp,
  createdBy: String
}

PaginaciÃ³n: SERVER-SIDE (eficiente para grandes datasets)
  query(
    collection(db, 'commitments'),
    orderBy('dueDate', 'desc'),
    limit(20),
    startAfter(lastDoc)
  )
  // Total count:
  getCountFromServer(query(collection(db, 'commitments')))

Filtros: SERVER-SIDE con where()
  â€¢ where('companyId', '==', companyId)
  â€¢ where('status', '==', status)
  â€¢ where('concept', '==', concept)
  â€¢ where('beneficiary', '==', beneficiary)
  â€¢ where('dueDate', '>=', startDate)

Status Calculation:
  if (totalPaid >= amount) â†’ 'paid'
  else if (totalPaid > 0) â†’ 'partially-paid'
  else if (dueDate < today) â†’ 'overdue'
  else â†’ 'pending'

APK: CompromisosListScreen + CompromisoDetailScreen


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
MÃ“DULO 3: PAGOS âœ…
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Archivo: src/pages/PaymentsPage.jsx

Collection: payments
{
  commitmentId: String,
  companyId: String,
  companyName: String,
  beneficiary: String,
  concept: String,
  amount: Number,
  paymentDate: Timestamp,
  paymentMethod: 'transferencia' | 'efectivo' | 'cheque' | 'tarjeta',
  receiptURL: String,              // Firebase Storage URL
  receiptName: String,
  receiptSize: Number,
  receiptType: String,
  observations: String,
  is4x1000Tax: Boolean,
  linkedAccountId: String,
  createdAt: Timestamp,
  createdBy: String
}

PaginaciÃ³n: CLIENT-SIDE (carga todo, luego slice)
  onSnapshot(
    query(collection(db, 'payments'), orderBy('paymentDate', 'desc'))
  )
  // Luego: payments.slice(page * 20, (page + 1) * 20)

Filtros: CLIENT-SIDE despuÃ©s de cargar
  â€¢ Search term (concept, beneficiary)
  â€¢ Company filter
  â€¢ Receipts filter (con/sin comprobante)
  â€¢ Date range filter

Comprobantes: Almacenados en Firebase Storage, URL en documento

APK: PagosListScreen + PagoDetailScreen (visor comprobantes)


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
MÃ“DULO 4: CUENTAS BANCARIAS âœ…
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Archivo: src/pages/BankAccountsPage.jsx

Collections:

1. personal_accounts (cuentas globales)
{
  accountName: String,
  bankName: String,
  accountNumber: String,
  accountType: 'ahorros' | 'corriente',
  currency: 'COP' | 'USD',
  initialBalance: Number,
  currentBalance: Number,          // Calculado
  isActive: Boolean,
  createdAt: Timestamp
}

2. incomes (ingresos)
{
  accountId: String,
  companyId: String,
  companyName: String,
  amount: Number,
  date: Timestamp,
  concept: String,
  observations: String,
  receiptURL: String
}

3. payments (pagos con is4x1000Tax: true y linkedAccountId)

CÃ¡lculo de Saldo:
  currentBalance = initialBalance 
                   + Î£(incomes where accountId = X)
                   - Î£(payments where linkedAccountId = X && is4x1000Tax = true)

Movimientos: Merge incomes + payments, ordenar por fecha desc

APK: CuentasBancariasScreen + CuentaDetailScreen


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
MÃ“DULO 5: GESTIÃ“N EMPRESARIAL âœ…
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Archivo: src/pages/CompaniesPage.jsx

Collections:

1. companies
{
  name: String,
  nit: String,
  email: String,
  legalRepresentative: String,
  contractNumber: String,
  contractExpirationDate: Timestamp,
  logoURL: String,
  bankAccount: String,
  bankName: String,
  accountType: String,
  bankCertificationURL: String,
  platforms: {
    coljuegos: { username, password, link },
    houndoc: { username, password, link },
    dian: { nit, cedula, password, link },
    supersalud: { username, password, link }
  }
}

2. clientes
{
  name: String,
  identification: String,
  phone: String,
  email: String,
  companyId: String,
  companyName: String
}

3. salas
{
  name: String,
  code: String,
  companyId: String,
  companyName: String,
  address: String,
  city: String,
  capacity: Number,
  rentalCost: Number,
  services: Array
}

Relaciones:
  â€¢ empresa.id â†’ clientes.companyId
  â€¢ empresa.id â†’ salas.companyId

APK: EmpresasListScreen, ClientesListScreen, SalasListScreen


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
MÃ“DULO 6: REPORTES âœ…
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Archivos: 
  - src/pages/reports/ReportsCompanyPage.jsx
  - src/pages/reports/ReportsPeriodPage.jsx
  - src/pages/reports/ReportsConceptPage.jsx

LÃ³gica de AgregaciÃ³n:

1. Por Empresa:
  companies.map(company => ({
    companyName: company.name,
    totalCompromisos: Î£(amount where companyId = company.id),
    totalPagado: Î£(totalPaid where companyId = company.id),
    pendiente: totalCompromisos - totalPagado
  }))

2. Por PerÃ­odo:
  commitments.reduce((acc, commitment) => {
    const period = format(commitment.dueDate, 'MM/yyyy');
    acc[period] = (acc[period] || 0) + commitment.amount;
    return acc;
  }, {})

3. Por Concepto:
  commitments.reduce((acc, commitment) => {
    acc[commitment.concept] = {
      total: (acc[commitment.concept]?.total || 0) + commitment.amount,
      empresas: new Set([...empresas, commitment.companyName])
    };
    return acc;
  }, {})

GrÃ¡ficos: BarChart, PieChart, LineChart

APK: ReportesScreen con 3 tabs


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
MÃ“DULO 7: ASISTENCIAS âœ…
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Archivo: src/pages/AsistenciasPage.jsx

Collection: asistencias
{
  uid: String,
  fecha: String (YYYY-MM-DD),
  entrada: {
    hora: Timestamp,
    ubicacion: { lat, lon },
    dispositivo: String
  },
  breaks: [{
    inicio: Timestamp,
    fin: Timestamp,
    duracion: String (HH:MM:SS)
  }],
  almuerzo: {
    inicio: Timestamp,
    fin: Timestamp,
    duracion: String
  },
  salida: {
    hora: Timestamp
  },
  horasTrabajadas: String (HH:MM:SS),
  estadoActual: 'trabajando' | 'break' | 'almuerzo' | 'finalizado'
}

Query:
  // USER: Solo sus propias asistencias
  query(
    collection(db, 'asistencias'),
    where('uid', '==', currentUser.uid),
    orderBy('fecha', 'desc')
  )

  // ADMIN: Todas las asistencias
  query(
    collection(db, 'asistencias'),
    orderBy('fecha', 'desc')
  )

Filtros:
  â€¢ Por fecha (rango)
  â€¢ Por usuario (solo ADMIN)

APK: Mejorar AsistenciasScreen existente + AsistenciaDetailScreen


================================================================================
ğŸš€ IMPLEMENTACIÃ“N - PASO A PASO
================================================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FASE 1: NAVEGACIÃ“N BASE (2-3 DÃAS)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Paso 1.1: Instalar Dependencias
--------------------------------
cd mobile
npx expo install @react-navigation/native @react-navigation/bottom-tabs @react-navigation/stack react-native-screens react-native-safe-area-context


Paso 1.2: Crear Bottom Tab Navigator
-------------------------------------
Archivo: mobile/src/navigation/AppNavigator.js

import { createBottomTabNavigator } from '@react-navigation/bottom-tabs';
import { MaterialIcons } from '@expo/vector-icons';
import InicioStack from './InicioStack';
import ConsultasStack from './ConsultasStack';
import EmpresarialStack from './EmpresarialStack';
import ReportesStack from './ReportesStack';
import { ThemeContext } from '../contexts/ThemeContext';

const Tab = createBottomTabNavigator();

export default function AppNavigator() {
  const { getPrimaryColor } = useContext(ThemeContext);
  
  return (
    <Tab.Navigator
      screenOptions={{
        headerShown: false,
        tabBarActiveTintColor: getPrimaryColor(),
        tabBarInactiveTintColor: '#999',
        tabBarStyle: {
          backgroundColor: '#fff',
          borderTopWidth: 1,
          borderTopColor: 'rgba(0,0,0,0.1)',
          paddingBottom: 8,
          paddingTop: 8,
          height: 60
        }
      }}
    >
      <Tab.Screen 
        name="InicioTab" 
        component={InicioStack}
        options={{
          title: 'Inicio',
          tabBarIcon: ({ color, size }) => (
            <MaterialIcons name="home" size={size} color={color} />
          )
        }}
      />
      <Tab.Screen 
        name="ConsultasTab" 
        component={ConsultasStack}
        options={{
          title: 'Consultas',
          tabBarIcon: ({ color, size }) => (
            <MaterialIcons name="search" size={size} color={color} />
          )
        }}
      />
      <Tab.Screen 
        name="EmpresarialTab" 
        component={EmpresarialStack}
        options={{
          title: 'Empresarial',
          tabBarIcon: ({ color, size }) => (
            <MaterialIcons name="business" size={size} color={color} />
          )
        }}
      />
      <Tab.Screen 
        name="ReportesTab" 
        component={ReportesStack}
        options={{
          title: 'MÃ¡s',
          tabBarIcon: ({ color, size }) => (
            <MaterialIcons name="more-horiz" size={size} color={color} />
          )
        }}
      />
    </Tab.Navigator>
  );
}


Paso 1.3: Crear Stack Navigators
---------------------------------
Crear archivos:
  â€¢ mobile/src/navigation/InicioStack.js
  â€¢ mobile/src/navigation/ConsultasStack.js
  â€¢ mobile/src/navigation/EmpresarialStack.js
  â€¢ mobile/src/navigation/ReportesStack.js

Ejemplo: InicioStack.js

import { createStackNavigator } from '@react-navigation/stack';
import DashboardScreen from '../screens/dashboard/DashboardScreen';
import CalendarioScreen from '../screens/calendario/CalendarioScreen';

const Stack = createStackNavigator();

export default function InicioStack() {
  return (
    <Stack.Navigator 
      screenOptions={{ 
        headerShown: true,
        headerStyle: {
          backgroundColor: '#fff',
          elevation: 0,
          shadowOpacity: 0
        }
      }}
    >
      <Stack.Screen 
        name="Dashboard" 
        component={DashboardScreen}
        options={{ title: 'Jornada Laboral' }}
      />
      <Stack.Screen 
        name="Calendario" 
        component={CalendarioScreen}
        options={{ title: 'Calendario' }}
      />
    </Stack.Navigator>
  );
}


Paso 1.4: Crear Hook de Permisos
---------------------------------
Archivo: mobile/src/hooks/usePermissions.js

import { useContext } from 'react';
import { AuthContext } from '../contexts/AuthContext';

export const usePermissions = () => {
  const { userProfile } = useContext(AuthContext);

  const hasPermission = (permission) => {
    if (!userProfile) return false;
    if (userProfile.role === 'SUPER_ADMIN') return true;
    if (userProfile.role === 'ADMIN') return true;
    return userProfile.permissions?.[permission] === true;
  };

  const isAdmin = () => {
    return userProfile?.role === 'ADMIN' || userProfile?.role === 'SUPER_ADMIN';
  };

  const isUser = () => {
    return userProfile?.role === 'USER';
  };

  return { hasPermission, isAdmin, isUser };
};


Paso 1.5: Crear Componentes Base
---------------------------------
Crear archivos:
  â€¢ mobile/src/components/shared/EmptyState.js
  â€¢ mobile/src/components/shared/ErrorState.js
  â€¢ mobile/src/components/shared/LoadingState.js

EmptyState.js:

import React from 'react';
import { View, Text, StyleSheet } from 'react-native';
import { MaterialIcons } from '@expo/vector-icons';

export default function EmptyState({ icon, message }) {
  return (
    <View style={styles.container}>
      <MaterialIcons name={icon || 'inbox'} size={64} color="#ccc" />
      <Text style={styles.message}>{message || 'No hay datos'}</Text>
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    padding: 24
  },
  message: {
    fontSize: 16,
    color: '#999',
    marginTop: 16,
    textAlign: 'center'
  }
});


ErrorState.js:

import React from 'react';
import { View, Text, StyleSheet, TouchableOpacity } from 'react-native';
import { MaterialIcons } from '@expo/vector-icons';

export default function ErrorState({ message, onRetry }) {
  return (
    <View style={styles.container}>
      <MaterialIcons name="error-outline" size={64} color="#f44336" />
      <Text style={styles.message}>{message || 'Error al cargar datos'}</Text>
      {onRetry && (
        <TouchableOpacity style={styles.button} onPress={onRetry}>
          <Text style={styles.buttonText}>Reintentar</Text>
        </TouchableOpacity>
      )}
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    padding: 24
  },
  message: {
    fontSize: 16,
    color: '#666',
    marginTop: 16,
    textAlign: 'center',
    marginBottom: 16
  },
  button: {
    backgroundColor: '#2196f3',
    paddingHorizontal: 24,
    paddingVertical: 12,
    borderRadius: 24,
    elevation: 2
  },
  buttonText: {
    color: '#fff',
    fontSize: 15,
    fontWeight: '600'
  }
});


LoadingState.js:

import React from 'react';
import { View, ActivityIndicator, Text, StyleSheet } from 'react-native';

export default function LoadingState({ message }) {
  return (
    <View style={styles.container}>
      <ActivityIndicator size="large" color="#667eea" />
      {message && <Text style={styles.message}>{message}</Text>}
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    padding: 24
  },
  message: {
    fontSize: 15,
    color: '#999',
    marginTop: 16,
    textAlign: 'center'
  }
});


Paso 1.6: Actualizar App.js
----------------------------
Archivo: mobile/App.js

import { NavigationContainer } from '@react-navigation/native';
import { AuthContext } from './src/contexts/AuthContext';
import { ThemeContext } from './src/contexts/ThemeContext';
import AppNavigator from './src/navigation/AppNavigator';
import LoginScreen from './src/screens/auth/LoginScreen';

export default function App() {
  const { user } = useContext(AuthContext);

  return (
    <NavigationContainer>
      {user ? <AppNavigator /> : <LoginScreen />}
    </NavigationContainer>
  );
}


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FASE 2: CALENDARIO + COMPROMISOS (4-5 DÃAS)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Paso 2.1: CalendarioScreen
---------------------------
Archivo: mobile/src/screens/calendario/CalendarioScreen.js

import React, { useState, useEffect } from 'react';
import { View, Text, FlatList, StyleSheet, RefreshControl } from 'react-native';
import { onSnapshot, query, collection, orderBy } from 'firebase/firestore';
import { db } from '../../services/firebase';
import SobrioCard from '../../components/SobrioCard';
import LoadingState from '../../components/shared/LoadingState';
import ErrorState from '../../components/shared/ErrorState';
import EmptyState from '../../components/shared/EmptyState';
import { format } from 'date-fns';
import { es } from 'date-fns/locale';

export default function CalendarioScreen() {
  const [eventos, setEventos] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [refreshing, setRefreshing] = useState(false);

  // âœ… REAL-TIME LISTENER (como DashboardCalendar.jsx)
  useEffect(() => {
    const q = query(
      collection(db, 'calendar_events'),
      orderBy('date', 'asc')
    );

    const unsubscribe = onSnapshot(
      q,
      (snapshot) => {
        const eventosData = [];
        snapshot.forEach((doc) => {
          const data = doc.data();
          eventosData.push({
            id: doc.id,
            ...data,
            date: data.date?.toDate ? data.date.toDate() : new Date(data.date)
          });
        });
        
        setEventos(eventosData);
        setLoading(false);
        setError(null);
      },
      (err) => {
        console.error('Error cargando eventos:', err);
        setError(err.message);
        setLoading(false);
      }
    );

    return () => unsubscribe();
  }, []);

  const onRefresh = () => {
    setRefreshing(true);
    // El listener se encarga de actualizar automÃ¡ticamente
    setTimeout(() => setRefreshing(false), 1000);
  };

  if (loading) return <LoadingState message="Cargando eventos..." />;
  if (error) return <ErrorState message={error} onRetry={() => setLoading(true)} />;
  if (eventos.length === 0) return <EmptyState icon="event" message="No hay eventos programados" />;

  const getPriorityColor = (priority) => {
    switch (priority) {
      case 'urgent': return '#f44336';
      case 'high': return '#ff9800';
      case 'medium': return '#ffc107';
      case 'low': return '#4caf50';
      default: return '#9e9e9e';
    }
  };

  const renderEvento = ({ item }) => (
    <SobrioCard style={styles.eventoCard}>
      <View style={styles.eventoHeader}>
        <View style={[styles.priorityIndicator, { backgroundColor: getPriorityColor(item.priority) }]} />
        <View style={styles.eventoContent}>
          <Text style={styles.eventoTitle}>{item.title}</Text>
          <Text style={styles.eventoDate}>
            {format(item.date, "EEEE, d 'de' MMMM 'de' yyyy", { locale: es })}
          </Text>
          {item.description && (
            <Text style={styles.eventoDescription}>{item.description}</Text>
          )}
        </View>
      </View>
    </SobrioCard>
  );

  return (
    <View style={styles.container}>
      <FlatList
        data={eventos}
        renderItem={renderEvento}
        keyExtractor={(item) => item.id}
        contentContainerStyle={styles.list}
        refreshControl={
          <RefreshControl refreshing={refreshing} onRefresh={onRefresh} />
        }
      />
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#f5f5f5'
  },
  list: {
    padding: 16
  },
  eventoCard: {
    marginBottom: 12
  },
  eventoHeader: {
    flexDirection: 'row'
  },
  priorityIndicator: {
    width: 4,
    borderRadius: 2,
    marginRight: 12
  },
  eventoContent: {
    flex: 1
  },
  eventoTitle: {
    fontSize: 18,
    fontWeight: '600',
    color: '#333',
    marginBottom: 4
  },
  eventoDate: {
    fontSize: 14,
    color: '#666',
    marginBottom: 8
  },
  eventoDescription: {
    fontSize: 14,
    color: '#999',
    lineHeight: 20
  }
});


Paso 2.2: CompromisosListScreen
--------------------------------
Archivo: mobile/src/screens/compromisos/CompromisosListScreen.js

import React, { useState, useEffect } from 'react';
import { View, FlatList, StyleSheet, TouchableOpacity } from 'react-native';
import { query, collection, orderBy, limit, startAfter, getDocs, getCountFromServer } from 'firebase/firestore';
import { db } from '../../services/firebase';
import SobrioCard from '../../components/SobrioCard';
import DetailRow from '../../components/DetailRow';
import LoadingState from '../../components/shared/LoadingState';

export default function CompromisosListScreen({ navigation }) {
  const [compromisos, setCompromisos] = useState([]);
  const [loading, setLoading] = useState(true);
  const [lastDoc, setLastDoc] = useState(null);
  const [hasMore, setHasMore] = useState(true);
  const [totalCount, setTotalCount] = useState(0);

  const PAGE_SIZE = 20;

  // âœ… SERVER-SIDE PAGINATION (como CommitmentsList.jsx)
  const loadCompromisos = async (isLoadMore = false) => {
    try {
      if (isLoadMore && !hasMore) return;

      let q = query(
        collection(db, 'commitments'),
        orderBy('dueDate', 'desc'),
        limit(PAGE_SIZE)
      );

      if (isLoadMore && lastDoc) {
        q = query(
          collection(db, 'commitments'),
          orderBy('dueDate', 'desc'),
          startAfter(lastDoc),
          limit(PAGE_SIZE)
        );
      }

      const snapshot = await getDocs(q);
      const compromisosData = [];
      
      snapshot.forEach((doc) => {
        const data = doc.data();
        compromisosData.push({
          id: doc.id,
          ...data,
          dueDate: data.dueDate?.toDate ? data.dueDate.toDate() : new Date(data.dueDate)
        });
      });

      if (isLoadMore) {
        setCompromisos(prev => [...prev, ...compromisosData]);
      } else {
        setCompromisos(compromisosData);
        // Obtener total count solo la primera vez
        const countSnapshot = await getCountFromServer(query(collection(db, 'commitments')));
        setTotalCount(countSnapshot.data().count);
      }

      setLastDoc(snapshot.docs[snapshot.docs.length - 1]);
      setHasMore(compromisosData.length === PAGE_SIZE);
      setLoading(false);
    } catch (error) {
      console.error('Error cargando compromisos:', error);
      setLoading(false);
    }
  };

  useEffect(() => {
    loadCompromisos();
  }, []);

  const renderCompromiso = ({ item }) => (
    <TouchableOpacity 
      onPress={() => navigation.navigate('CompromisoDetail', { compromisoId: item.id })}
    >
      <SobrioCard style={styles.card}>
        <DetailRow 
          icon="business" 
          label="Empresa" 
          value={item.companyName} 
        />
        <DetailRow 
          icon="receipt" 
          label="Concepto" 
          value={item.concept} 
        />
        <DetailRow 
          icon="attach-money" 
          label="Monto" 
          value={`$${item.amount.toLocaleString('es-CO')}`} 
        />
        <DetailRow 
          icon="event" 
          label="Vencimiento" 
          value={format(item.dueDate, 'dd/MM/yyyy')} 
        />
      </SobrioCard>
    </TouchableOpacity>
  );

  if (loading) return <LoadingState message="Cargando compromisos..." />;

  return (
    <View style={styles.container}>
      <FlatList
        data={compromisos}
        renderItem={renderCompromiso}
        keyExtractor={(item) => item.id}
        contentContainerStyle={styles.list}
        onEndReached={() => loadCompromisos(true)}
        onEndReachedThreshold={0.5}
      />
    </View>
  );
}


Paso 2.3: CompromisoDetailScreen
---------------------------------
Archivo: mobile/src/screens/compromisos/CompromisoDetailScreen.js

(Implementar vista detallada con todos los campos del compromiso)


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FASE 3: PAGOS + CUENTAS (4-5 DÃAS)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Paso 3.1: PagosListScreen
--------------------------
Archivo: mobile/src/screens/pagos/PagosListScreen.js

import { onSnapshot, query, collection, orderBy } from 'firebase/firestore';

// âœ… CLIENT-SIDE PAGINATION (como PaymentsPage.jsx)
useEffect(() => {
  const q = query(
    collection(db, 'payments'),
    orderBy('paymentDate', 'desc')
  );

  const unsubscribe = onSnapshot(q, (snapshot) => {
    const pagosData = [];
    snapshot.forEach((doc) => {
      pagosData.push({ id: doc.id, ...doc.data() });
    });
    setAllPagos(pagosData);
    setLoading(false);
  });

  return () => unsubscribe();
}, []);

// PaginaciÃ³n client-side
const paginatedPagos = allPagos.slice(page * 20, (page + 1) * 20);


Paso 3.2: PagoDetailScreen
---------------------------
(Implementar visor de comprobantes desde Firebase Storage)


Paso 3.3: CuentasBancariasScreen
---------------------------------
(Implementar carga de personal_accounts, incomes, payments y cÃ¡lculo de saldos)


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FASE 4: GESTIÃ“N EMPRESARIAL (5-7 DÃAS)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Paso 4.1: EmpresasListScreen
-----------------------------
Collection: companies
â€¢ Mostrar lista con logos
â€¢ Navegar a detalle

Paso 4.2: ClientesListScreen
-----------------------------
Collection: clientes
â€¢ Filtrar por empresa (si viene de EmpresaDetailScreen)

Paso 4.3: SalasListScreen
--------------------------
Collection: salas
â€¢ Filtrar por empresa


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FASE 5: REPORTES (5-6 DÃAS)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Paso 5.1: Instalar GrÃ¡ficos
----------------------------
npx expo install react-native-chart-kit react-native-svg


Paso 5.2: ReportesScreen
-------------------------
Implementar 3 tabs:
â€¢ Por Empresa (BarChart)
â€¢ Por PerÃ­odo (LineChart)
â€¢ Por Concepto (PieChart)


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FASE 6: ASISTENCIAS MEJORADO (3-4 DÃAS)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Paso 6.1: Mejorar AsistenciasScreen
------------------------------------
â€¢ Agregar filtros avanzados
â€¢ Query adaptado segÃºn rol (USER vs ADMIN)

Paso 6.2: AsistenciaDetailScreen
---------------------------------
â€¢ Breakdown completo de jornada


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FASE 7: OPTIMIZACIÃ“N (3-4 DÃAS)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â€¢ React.memo en componentes de lista
â€¢ useMemo para cÃ¡lculos pesados
â€¢ useCallback para callbacks
â€¢ AsyncStorage cache
â€¢ Error boundaries


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FASE 8: BUILD Y DEPLOYMENT (1-2 DÃAS)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

cd mobile
eas build --platform android --profile production


================================================================================
âœ… CHECKLIST DE VALIDACIÃ“N
================================================================================

FASE 1:
  [ ] NavegaciÃ³n con 4 tabs funcional
  [ ] Hook usePermissions implementado
  [ ] Componentes base creados (EmptyState, ErrorState, LoadingState)

FASE 2:
  [ ] CalendarioScreen con real-time listener
  [ ] CompromisosListScreen con paginaciÃ³n SERVER-SIDE
  [ ] Filtros funcionando correctamente

FASE 3:
  [ ] PagosListScreen con paginaciÃ³n CLIENT-SIDE
  [ ] Visor de comprobantes funcional
  [ ] Cuentas con cÃ¡lculo de saldos correcto

FASE 4:
  [ ] EmpresasListScreen mostrando logos
  [ ] ClientesListScreen con filtros
  [ ] SalasListScreen con filtros

FASE 5:
  [ ] Reportes con grÃ¡ficos funcionando
  [ ] 3 tabs implementados

FASE 6:
  [ ] AsistenciasScreen con filtros por rol
  [ ] AsistenciaDetailScreen completo

FASE 7:
  [ ] Performance optimizada
  [ ] Cache implementado
  [ ] Error boundaries funcionando

FASE 8:
  [ ] APK generado exitosamente
  [ ] Testing QA completo
  [ ] Deployment a producciÃ³n


================================================================================
ğŸ“‹ NOTAS IMPORTANTES
================================================================================

â€¢ SIEMPRE usar Set-Location mobile; antes de comandos Expo/npm
â€¢ NUNCA hardcodear colores, usar getPrimaryColor() / getSecondaryColor()
â€¢ SIEMPRE seguir diseÃ±o Material 3 Expressive
â€¢ NUNCA calcular duraciones desde campo 'duracion', usar timestamps
â€¢ SIEMPRE usar campo 'name' como displayName principal
â€¢ VERIFICAR que APK y Dashboard comparten la misma instancia de Firebase
â€¢ CONSULTAR dashboard web ante cualquier duda sobre lÃ³gica de negocio


================================================================================
FIN DEL DOCUMENTO
================================================================================
Documento creado: 12 de noviembre de 2025
Proyecto: DR Group Dashboard - APK MÃ³vil (Consulta Only)
Tiempo estimado: 25-35 dÃ­as
